Rework config parsing code to enable easier bug fixing and maintainability.
